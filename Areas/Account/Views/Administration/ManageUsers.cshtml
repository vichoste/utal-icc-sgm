@using Utal.Icc.Sgm
@using Utal.Icc.Sgm.Areas.Account.Views.Administration

@model PaginatedList<ManageUsersViewModel>

@{
	this.ViewData["Title"] = "Gestionar usuarios";
}

<div class="container">
	@if (this.ViewBag.SuccessMessage is not null) {
		<div class="row justify-content-center">
			<div class="alert alert-success" role="alert">
				@this.ViewBag.SuccessMessage
			</div>
		</div>
	}
	@if (this.ViewBag.WarningMessage is not null) {
		<div class="row justify-content-center">
			<div class="alert alert-warning" role="alert">
				@this.ViewBag.WarningMessage
			</div>
		</div>
	}
	@if (this.ViewBag.WarningMessages is not null) {
		@foreach (var warning in this.ViewBag.WarningMessages) {
			<div class="row justify-content-center">
				<div class="alert alert-warning" role="alert">
					@warning
				</div>
			</div>
		}
	}
	@if (this.ViewBag.ErrorMessage is not null) {
		<div class="row justify-content-center">
			<div class="alert alert-danger" role="alert">
				@this.ViewBag.ErrorMessage
			</div>
		</div>
	}
	@if (this.ViewBag.ErrorMessages is not null) {
		@foreach (var error in this.ViewBag.ErrorMessages) {
			<div class="row justify-content-center">
				<div class="alert alert-danger" role="alert">
					@error
				</div>
			</div>
		}
	}
	<div class="row justify-content-center">
		<div class="col-12 col-md-10 mb-3">
			<h2>Gestionar usuarios</h2>
		</div>
		<div class="col-12 col-md-2 mb-3">
			@this.Html.ActionLink("Crear usuario", "CreateUser", "Administration", new { area = "Account" }, new { @class = "btn btn-success"})
		</div>
		<div class="col-12 mb-3">
			<partial name="_Filter" , model="@new FilterPartialViewModel()" />
		</div>
	</div>
	<div class="row justify-content-center">
		<div class="col-12">
			<div class="table-responsive">
				<table class="table table-bordered">
					<thead class="table-dark">
						<tr>
							<th>
								<a asp-action="ManageUsers" asp-route-sortOrder="@this.ViewData["FirstNameSortParam"]" asp-route-currentFilter="@this.ViewData["CurrentFilter"]">
									Nombre
								</a>
							</th>
							<th>
								<a asp-action="ManageUsers" asp-route-sortOrder="@this.ViewData["LastNameSortParam"]" asp-route-currentFilter="@this.ViewData["CurrentFilter"]">
									Apellido
								</a>
							</th>
							<th>
								<a asp-action="ManageUsers" asp-route-sortOrder="@this.ViewData["RutSortParam"]" asp-route-currentFilter="@this.ViewData["CurrentFilter"]">
									RUT
								</a>
							</th>
							<th>
								<a asp-action="ManageUsers" asp-route-sortOrder="@this.ViewData["UniversityIdSortParam"]" asp-route-currentFilter="@this.ViewData["CurrentFilter"]">
									Número de matrícula
								</a>
							</th>
							<th>
								<a asp-action="ManageUsers" asp-route-sortOrder="@this.ViewData["EmailSortParam"]" asp-route-currentFilter="@this.ViewData["CurrentFilter"]">
									E-mail
								</a>
							</th>
							<th>Acciones</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model) {
							<tr>
								<td>@item.FirstName</td>
								<td>@item.LastName</td>
								<td>@item.Rut</td>
								<td>@item.UniversityId</td>
								<td>@item.Email</td>
								<td>
									@this.Html.ActionLink("Editar", "EditUser", "Administration", new { area = "Account", id = item.Id }, new { @class = "btn btn-yellow mb-3"})
									@this.Html.ActionLink("Deshabilitar", "DisableUser", "Administration", new { area = "Account", id = item.Id }, new { @class = "btn btn-danger mb-3"})
								</td>
							</tr>
						}
					</tbody>
				</table>
				@{
					var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
					var nextDisabled = !Model.HasNextPage ? "disabled" : "";
				}
				<a asp-action="ManageUsers" asp-route-sortOrder="@ViewData["CurrentSort"]" asp-route-pageNumber="@(Model.PageIndex - 1)" asp-route-currentFilter="@ViewData["CurrentFilter"]" class="btn btn-default @prevDisabled">
					Anterior página
				</a>
				<a asp-action="ManageUsers" asp-route-sortOrder="@ViewData["CurrentSort"]" asp-route-pageNumber="@(Model.PageIndex + 1)" asp-route-currentFilter="@ViewData["CurrentFilter"]" class="btn btn-default @nextDisabled">
					Siguiente página
				</a>
			</div>
		</div>
	</div>
</div>